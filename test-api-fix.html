<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .success { background: #d4edda; border-color: #28a745; }
        .error { background: #f8d7da; border-color: #dc3545; }
        .info { background: #d1ecf1; border-color: #17a2b8; }
        .warning { background: #fff3cd; border-color: #ffc107; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ APIä¿®å¤æµ‹è¯•</h1>
        <p>æµ‹è¯•ä¿®å¤åçš„APIè¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        
        <div class="test-section">
            <button onclick="testDirectWorkers()">ğŸ¯ æµ‹è¯•ç›´æ¥Workersè¿æ¥</button>
            <button onclick="testApiService()">ğŸ“¡ æµ‹è¯•ApiServiceç±»</button>
            <button onclick="testFullFlow()">ğŸ”„ æµ‹è¯•å®Œæ•´æµç¨‹</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
        </div>

        <div id="results"></div>
    </div>

    <script type="module">
        // å¯¼å…¥ApiServiceç±»
        import { ApiService } from './src/services/ApiService.js';
        
        const apiService = new ApiService();
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            
            const statusIcon = type === 'success' ? 'âœ…' : 
                              type === 'error' ? 'âŒ' : 
                              type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            const timeStr = `[${new Date().toLocaleTimeString()}] `;
            div.innerHTML = `${statusIcon} ${timeStr}${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        async function testDirectWorkers() {
            addResult('=== æµ‹è¯•ç›´æ¥Workersè¿æ¥ ===', 'info');
            
            try {
                const response = await fetch('https://keywords-api.andyzzz1984.workers.dev/api/health');
                const data = await response.json();
                addResult(`å¥åº·æ£€æŸ¥æˆåŠŸ: ${JSON.stringify(data)}`, 'success');
            } catch (error) {
                addResult(`å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
            
            try {
                const response = await fetch('https://keywords-api.andyzzz1984.workers.dev/api/keywords');
                const data = await response.json();
                addResult(`è·å–å…³é”®è¯æˆåŠŸ: ${JSON.stringify(data)}`, 'success');
            } catch (error) {
                addResult(`è·å–å…³é”®è¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testApiService() {
            addResult('=== æµ‹è¯•ApiServiceç±» ===', 'info');
            
            try {
                const keywords = await apiService.loadKeywords();
                addResult(`ApiServiceåŠ è½½å…³é”®è¯æˆåŠŸ: ${JSON.stringify(keywords)}`, 'success');
            } catch (error) {
                addResult(`ApiServiceåŠ è½½å…³é”®è¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testFullFlow() {
            addResult('=== æµ‹è¯•å®Œæ•´æµç¨‹ ===', 'info');
            
            const testKeywords = ['æµ‹è¯•å…³é”®è¯1', 'æµ‹è¯•å…³é”®è¯2', `æµ‹è¯•_${Date.now()}`];
            
            try {
                // ä¿å­˜å…³é”®è¯
                addResult('æ­£åœ¨ä¿å­˜å…³é”®è¯...', 'info');
                const saveResult = await apiService.saveKeywords(testKeywords);
                addResult(`ä¿å­˜æˆåŠŸ: ${JSON.stringify(saveResult)}`, 'success');
                
                // ç­‰å¾…ä¸€ç§’
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // åŠ è½½å…³é”®è¯
                addResult('æ­£åœ¨åŠ è½½å…³é”®è¯...', 'info');
                const loadedKeywords = await apiService.loadKeywords();
                addResult(`åŠ è½½æˆåŠŸ: ${JSON.stringify(loadedKeywords)}`, 'success');
                
                // éªŒè¯æ•°æ®
                const hasAllKeywords = testKeywords.every(k => loadedKeywords.includes(k));
                if (hasAllKeywords) {
                    addResult('âœ… æ•°æ®éªŒè¯æˆåŠŸï¼šæ‰€æœ‰æµ‹è¯•å…³é”®è¯éƒ½å·²æ­£ç¡®ä¿å­˜å’ŒåŠ è½½', 'success');
                } else {
                    addResult('âš ï¸ æ•°æ®éªŒè¯è­¦å‘Šï¼šéƒ¨åˆ†å…³é”®è¯å¯èƒ½æœªæ­£ç¡®ä¿å­˜', 'warning');
                }
                
            } catch (error) {
                addResult(`å®Œæ•´æµç¨‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.testDirectWorkers = testDirectWorkers;
        window.testApiService = testApiService;
        window.testFullFlow = testFullFlow;
        window.clearResults = clearResults;

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            addResult('ğŸ”§ APIä¿®å¤æµ‹è¯•å·¥å…·å·²åŠ è½½', 'info');
            addResult('ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•ä¿®å¤åçš„APIè¿æ¥', 'info');
        });
    </script>
</body>
</html>
